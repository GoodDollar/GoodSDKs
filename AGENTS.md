# GoodSDKs Agent Handbook

## Mission & Priorities
- Keep the SDKs easy to extend, test, and ship so teams can integrate GoodDollar quickly.
- Preserve clear, typed APIs for identity, claim, and engagement flows.
- Share utilities across packages, avoid heavy dependencies, and match GoodProtocol ABIs/addresses.
- Maintain smooth CI via reliable linting, type-checking, and build pipelines.

## Environment Checklist
- Node.js `>=18`; enable Yarn with `corepack enable` if the global binary is missing.
- Install deps once per session with `yarn install --immutable` (Yarn 4 workspaces).
- Repo uses `turbo` for orchestrating workspace tasks and `tsup` for package builds.
- Prefer local runs; network calls (e.g., installing new deps) need approval when sandboxed.

## Daily Driver Commands
- `yarn install --immutable` – install all workspace deps.
- `yarn build` – run the full Turborepo build graph.
- `yarn lint` / `yarn format` – ESLint + Prettier across the monorepo.
- `yarn turbo run <task> --filter=<workspace>` – target a single package/app.
- `yarn workspace <name> build` – compile one SDK (tsup -> `dist/`).
- `yarn workspace @goodsdks/ui-components build-claim` / `yarn workspace @goodsdks/savings-widget build-savings` – Lit bundles.
- `yarn workspace @goodsdks/engagement-contracts test` – Hardhat tests (ensure local anvil or fork if required).

## Repository Map & Entry Points
**Packages**
- `packages/citizen-sdk` – core identity & claim logic. Primary exports live in `src/index.ts`; individual viem SDKs inside `src/sdks/`.
- `packages/react-hooks` – React/Wagmi hooks wrapping the citizen SDK. Start in `src/index.ts` and `src/citizen-sdk/`.
- `packages/ui-components` – Lit web components like `ClaimButton.ts`; build via `build-claim`.
- `packages/engagement-sdk` – helpers for engagement rewards; ABIs generated by contracts package into `src/abi/`.
- `packages/savings-sdk` & `packages/savings-widget` – savings integrations (Lit widget + underlying viem/wagmi SDKs).
- `packages/engagement-contracts` – Hardhat project feeding ABIs to `engagement-sdk`; avoid modifying contracts without coordinating with GoodProtocol.
- `packages/eslint-config` & `packages/typescript-config` – shared configuration consumed by other workspaces.

**Apps**
- `apps/demo-identity-app` – React + Tamagui demo using citizen SDK & hooks (`yarn dev`).
- `apps/engagement-app` – showcases engagement SDK flows (`yarn dev`).
- `apps/demo-webcomponents` – minimal Vite app loading the Lit components.

## Cross-Package Dependencies
- React hooks depend on `@goodsdks/citizen-sdk`; update SDK types before hooks.
- Web components (`ui-components`, `savings-widget`) wrap SDK calls; keep attributes minimal and ensure bundle size stays small.
- Engagement ABIs are generated by running `yarn workspace @goodsdks/engagement-contracts export-abis`; never hand-edit files under `packages/engagement-sdk/src/abi/`.

## Workflow Tips for Agents
- Use `rg`/`rg --files` for fast search instead of `grep`/`find`.
- When exploring data flow, start at each package’s `src/index.ts` barrel before drilling into `utils/` or `sdks/` folders.
- For new exports, update TypeScript types and ensure they surface through the workspace barrel file.
- Prefer composing utilities; avoid inline callbacks in JSX and keep Lit components under 3 kB.
- Document public APIs with JSDoc so generated `*.d.ts` remain clear.

## Validation Checklist
1. `yarn lint` and `yarn tsc --noEmit` pass (run `yarn turbo run lint --filter=<target>` for scoped checks).
2. Relevant packages rebuild (`yarn workspace <name> build`) and write fresh `dist/` output.
3. Demo apps touched by the change build without warnings (`yarn turbo run build --filter=apps/...`).
4. New functionality is covered by tests (Vitest, Hardhat) or exercised in a demo app.
5. Public entry points (`src/index.ts`, `dist/*.d.ts`) reflect the intended API surface.
6. Contract address/ABI changes originate from GoodProtocol; open an issue instead of modifying copies here.

## Contract & Deployment Notes
- Default networks (`production` | `staging` | `development`) are selected via environment config inside each SDK; mirror GoodProtocol constants.
- When contracts are updated in `engagement-contracts`, rebuild ABIs and sync dependent packages in the same PR.
- Hardhat uses ignition modules. Clean artifacts with `rm -rf packages/engagement-contracts/{artifacts,cache}` only if explicitly required.

## External References
- GoodProtocol source & ABIs: https://github.com/GoodDollar/GoodProtocol
- GoodDollar docs: https://docs.gooddollar.org
- Dev community: https://ubi.gd/GoodBuildersDiscord

Happy building! Clear commits, solid tests, and minimal dependencies keep GoodDollar’s SDKs welcoming for every contributor.
